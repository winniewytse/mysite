---
output:
  pagedown::html_paged:
    css: ["cv.css",  "https://use.fontawesome.com/releases/v5.15.4/css/all.css"]
    number_sections: false
links-to-footnotes: false
knit: pagedown::chrome_print
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
library(tidyverse)
library(knitr)
library(lubridate)
library(glue)

######## CREATE HELPER FUNCTIONS
# function which takes a name and replaces the first name with initial and dot
replace_first_name_with_initial_and_dot <- function(author_name) {
  str_replace(author_name, "(?<=\\S)\\S+", "\\.")
}

# function for doing this for an entry with a number of authors
replace_first_names_in_list_with_initial_and_dot <- function(authors){
  authors_split <- str_split(authors, ",") %>% 
    map(str_trim)
  
  authors_split[[1]] %>% map_chr(replace_first_name_with_initial_and_dot) %>% 
    paste0(collapse = ", ")
}

# function for adding leading zero's when there's more than 10 entries
padding_function <- function(cv_entries_tibble, letter_to_pad){
  if(nrow(cv_entries_tibble) > 9){
    cv_entries_tibble %>% 
      mutate(number = str_pad(row_number(), width = 2, side = "left", pad = "0"),
             number = str_c(letter_to_pad, number))
  } else {
    cv_entries_tibble %>% 
      mutate(number = str_pad(row_number(), width = 1, side = "left", pad = "0"),
             number = str_c(letter_to_pad, number))
  }
}

# function for making a year blank when it's the same as the one preceding it
blank_year_when_repeated <- function(cv_entry_tibble){
  cv_entry_tibble %>% 
    arrange(desc(date)) %>%
    mutate(year = ifelse(year != replace_na(lag(year), 1), year, ""))
}


####### READ IN DATA
#### publications #####
publications <- read_csv("publications.csv") %>% 
  filter(is.na(exclude)) %>%
  mutate(date = as.Date(date, "%m/%d/%y"), 
         year = year(date)) 

#### cv entries #####
cv_entries <- read_csv("cv_entries.csv") %>% 
  mutate(date = as.Date(date, "%m/%d/%y"),
         year = year(date), 
         date_end = as.Date(date_end, "%m/%d/%y"), 
         year_end = ifelse(is.na(date_end), date_end, str_sub(date_end, 1, 4))) %>%
  # mutate(year_end = case_when(
  #   date_end == "present" ~ date_end,
  #   !is.na(date_end) ~ str_sub(date_end, 1, 4),
  #   is.na(date_end) ~ date_end
  # )) %>%
  mutate(year = ifelse((is.na(year_end) | year == year_end),
                       year,
                       str_c(year, " --- ", year_end)))

```

:::::: {.title-and-contact}

::: {.title}
<h1 class="title">Winnie Wing-Yee Tse</h1>
:::

::: {.contact-info}
<a href="https://github.com/winniewytse"><i id="github" class="fab fa-github"></i></a>
  <a href="https://www.linkedin.com/in/winniewytse/"><i id="linkedin" class="fab fa-linkedin"></i></a>
  <a href="https://orcid.org/0000-0001-5175-6754"><i id="orcid" class="fab fa-orcid"></i></a>
  <a href="wingyeet@usc.edu"><i id="email" class="fas fa-envelope"></i></a>
:::

::::::


<div class="cv-entries">

```{r include=FALSE, eval=FALSE}
cv_entries %>% 
  filter(type == 'research_positions', is.na(exclude)) %>%
  mutate(what = glue("<span class='cv-entry-title'>{what}</span><br>",
                     "{where}"
  )) %>% 
  select(year, what) %>% 
  kable()
```


## Education

```{r}
cv_entries %>% 
  filter(type == 'education') %>% 
  mutate(what = glue("<span class='cv-entry-title'>{what}</span>, {where}<br>", 
                     "{additional_info}<br>",
                     "<span class='thesis-title'>{additional_info2})</span>")) %>% 
  select(year, what) %>% 
  kable()
```

## Awards & Fellowships

```{r}
cv_entries %>%
  filter(type %in% c('major_grants', 'awards')) %>%
  arrange(desc(date)) %>%
  mutate(what = if_else(is.na(additional_info),
                        glue("<span class='cv-entry-title'>{what}</span> ({additional_info2}), {where}"),
                        glue("<span class='cv-entry-title'>{what}</span> ({additional_info2}), {where}.<br>{additional_info}"))) %>%
  select(year, what) %>%
  kable()
```


## Publications {.three-split}

```{r}
publications %>%
  filter(type == "journal article") %>% 
  mutate(citation = glue("<span class='publication-authors'>{citations}</span><br>")) %>%
  padding_function(., "J") %>% 
  blank_year_when_repeated() %>%
  select(year, number, citation) %>%
  kable()
```



## Conference presentations {.three-split}

```{r}
publications %>% 
  filter(type == 'presentation') %>%
  blank_year_when_repeated() %>%
  mutate(date = gsub(" 0", " ", format(date, "%b %d, %Y")), 
         materials = ifelse(is.na(materials), "", materials), 
         what = glue("<span class='talk-title'>{who} ({date}). <i>{title}</i> [{session}]. {where}. {materials}</span><br>")) %>% 
  padding_function(., "P") %>% 
  select(year, number, what) %>%
  knitr::kable()
```



## Teaching experience

```{r}
cv_entries %>% 
  filter(type == 'teaching') %>% 
  mutate(info = case_when(
    is.na(additional_info) & is.na(additional_info2) ~ "", 
    !is.na(additional_info) & is.na(additional_info2) ~ additional_info, 
    !is.na(additional_info) & !is.na(additional_info2) ~ 
      paste0(additional_info, ". ", additional_info2, ".")
  ), 
         what = glue("<span class='cv-entry-title'>{what}</span>, {where} <br>",
                     "{info}")) %>% 
  blank_year_when_repeated() %>%
  select(year, what) %>% 
  kable()
```


<!-- ## R packages -->

```{r eval=FALSE, include=FALSE}
cv_entries %>% 
  filter(type == 'programming' & is.na(exclude)) %>% 
  replace_na(list(where = "", additional_info = "")) %>% 
  mutate(what = glue("<span class='cv-entry-title'>{what}</span>, {where}")) %>%
  arrange(desc(year)) %>% 
  mutate(row_number = row_number()) %>% 
  select(year, what) %>% 
  kable()
```


## Service

```{r}
cv_entries %>% 
  filter(type == 'service') %>% 
  mutate(where = if_else(!is.na(url), glue("[{where}]({url})"), where)) %>% 
  mutate(what = glue("<span class='cv-entry-title'>{what}</span> {where}")) %>%
  select(year, what) %>% 
  kable()
```


## Computer skills
:::::: {.computer-skills}

::: {.spacer}
:::

::: {.skills}
**Statistics**: R, SPSS, Stata, SAS, Mplus, Julia <br>
<ul>
  <li> **SEM**: R (`lavaan`), Mplus </li>
  <li> **Multilevel**: R (`lme4`), Mplus </li>
  <li> **Bayesian**: R (`brms`, `Rstan`, `Rjags`) </li>
</ul>
**Database**: SQL <br>
**Document preparation**: LaTeX, RMarkdown (`bookdown`, `pagedown`, `blogdown`), MS Excel, Word, Powerpoint <br>
**Frontend**: HTML, CSS, JavaScript <br>
:::
::::::


</div>

